version: "3"
services:
  lib:
    build:
      context: .
      dockerfile: ./packages/lib/Dockerfile.workflow
    environment:
      NODE_ENV: test
    command: bash -c 'yarn install && yarn workspace @team-10/lib run test:workflow'
    volumes:
      - ./.yarn/:/app/.yarn/
      - ./packages/lib/:/app/packages/lib/
      - ./coverage/:/app/coverage/:Z
      - ./.yarn/:/app/.yarn/:Z
  backend:
    build:
      context: .
      dockerfile: ./packages/backend/Dockerfile.workflow
    environment:
      NODE_ENV: test
    command: 'yarn install && yarn workspace @team-10/backend run test:workflow'
    volumes:
      - ./.yarn/:/app/.yarn/
      - ./packages/lib/:/app/packages/lib/
      - ./packages/backend/:/app/packages/backend/
      - ./coverage/:/app/coverage/:Z
      - ./.yarn/:/app/.yarn/:Z
  frontend:
    build:
      context: .
      dockerfile: ./packages/frontend/Dockerfile.workflow
    environment:
      NODE_ENV: test
    command: 'yarn install && yarn workspace @team-10/frontend run test:workflow'
    volumes:
      - ./.yarn/:/app/.yarn/
      - ./packages/lib/:/app/packages/lib/
      - ./packages/frontend/:/app/packages/frontend/
      - ./coverage/:/app/coverage/:Z
      - ./.yarn/:/app/.yarn/:Z
